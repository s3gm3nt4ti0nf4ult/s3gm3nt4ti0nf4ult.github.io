<!DOCTYPE html>
<html lang="pl">
<head>
  
    <title>PL: Misja Gynvaela PL011 :: FoxtrotLabs — Tam gdzie bajty mówią dobranoc</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Zadanie Na 49 streamie nie pojawił się co prawda utęskniony raytracing &amp;ldquo;bardzo rozproszony&amp;rdquo;, ale próba kryptoanalizy szyfrogramu na żywo również okazała się tematem wartym uwagi. Jak zwykle, pod koniec streamu czekała na agenta (lub nas) misja. Jej treść brzmi następująco:
MISJA 011 goo.gl/keE94T DIFFICULTY: █████░░░░░ [5/10] ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅ Jednemu z naszych agentów polowych poszczęściło się - zakradł się do biura podejrzanego i zrobił zdjęcie bardzo ważnego dokumentu. Zdjęcie udało się wywołać i otrzymaliśmy dzisiaj archiwum z jego skanem." />
<meta name="keywords" content="hacking" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://foxtrotlabs.cc/pl/2017/09/pl-misja-gynvaela-pl011/" />


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-148414315-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



<link rel="stylesheet" href="https://foxtrotlabs.cc/assets/style.css">

  <link rel="stylesheet" href="assets/%25!s%28%3cnil%3e%29.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://foxtrotlabs.cc/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="">



<meta name="twitter:card" content="summary" />

<meta name="twitter:creator" content="foxtrot_charlie" />


<meta property="og:locale" content="pl" />
<meta property="og:type" content="article" />
<meta property="og:title" content="PL: Misja Gynvaela PL011 :: FoxtrotLabs">
<meta property="og:description" content="Zadanie Na 49 streamie nie pojawił się co prawda utęskniony raytracing &amp;ldquo;bardzo rozproszony&amp;rdquo;, ale próba kryptoanalizy szyfrogramu na żywo również okazała się tematem wartym uwagi. Jak zwykle, pod koniec streamu czekała na agenta (lub nas) misja. Jej treść brzmi następująco:
MISJA 011 goo.gl/keE94T DIFFICULTY: █████░░░░░ [5/10] ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅ Jednemu z naszych agentów polowych poszczęściło się - zakradł się do biura podejrzanego i zrobił zdjęcie bardzo ważnego dokumentu. Zdjęcie udało się wywołać i otrzymaliśmy dzisiaj archiwum z jego skanem." />
<meta property="og:url" content="https://foxtrotlabs.cc/pl/2017/09/pl-misja-gynvaela-pl011/" />
<meta property="og:site_name" content="PL: Misja Gynvaela PL011" />

  
    <meta property="og:image" content="">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

  <meta property="article:section" content="pl" />

  <meta property="article:section" content="gynvaelstream" />

  <meta property="article:section" content="ctf" />


  <meta property="article:published_time" content="2017-09-29 16:01:15 &#43;0200 &#43;0200" />












</head>
<body class="">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://foxtrotlabs.cc/pl">
  <div class="logo">
    foxtrotlabs-pl
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="https://foxtrotlabs.cc/pl/posts">posty</a></li>
        
      
        
          <li><a href="https://foxtrotlabs.cc/">English side</a></li>
        
      
        
          <li><a href="https://foxtrotlabs.cc/pl/about">o mnie</a></li>
        
      
        
          <li><a href="https://github.com/s3gm3nt4ti0nf4ult">github</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="https://foxtrotlabs.cc/pl/posts">posty</a></li>
      
    
      
        <li><a href="https://foxtrotlabs.cc/">English side</a></li>
      
    
      
        <li><a href="https://foxtrotlabs.cc/pl/about">o mnie</a></li>
      
    
      
        <li><a href="https://github.com/s3gm3nt4ti0nf4ult">github</a></li>
      
    
    
  </ul>
</nav>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-148414315-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://foxtrotlabs.cc/pl/2017/09/pl-misja-gynvaela-pl011/">PL: Misja Gynvaela PL011</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2017-09-29 
      </span>
    
    
    <span class="post-author">::
      foxtrot_charlie
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://foxtrotlabs.cc/pl/tags/pl/">pl</a>&nbsp;
    
    #<a href="https://foxtrotlabs.cc/pl/tags/ctf/">ctf</a>&nbsp;
    
    #<a href="https://foxtrotlabs.cc/pl/tags/security/">security</a>&nbsp;
    
    #<a href="https://foxtrotlabs.cc/pl/tags/gynvaelstream/">gynvaelstream</a>&nbsp;
    
    #<a href="https://foxtrotlabs.cc/pl/tags/hacking/">hacking</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content"><div>
        <h3 id="zadanie">Zadanie<a href="#zadanie" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Na <a href="https://www.youtube.com/watch?v=lDsigXCo5TA">49</a> streamie nie pojawił się co prawda utęskniony raytracing &ldquo;bardzo rozproszony&rdquo;, ale próba kryptoanalizy szyfrogramu na żywo również okazała się tematem wartym uwagi. Jak zwykle, pod koniec streamu czekała na agenta (lub nas) misja. Jej treść brzmi następująco:</p>
<pre><code>MISJA 011            goo.gl/keE94T                  DIFFICULTY: █████░░░░░ [5/10]
┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅

Jednemu z naszych agentów polowych poszczęściło się - zakradł się do biura
podejrzanego i zrobił zdjęcie bardzo ważnego dokumentu. Zdjęcie udało się wywołać
i otrzymaliśmy dzisiaj archiwum z jego skanem.

Ponieważ jestem obecnie bardzo zajęty i mam bardzo ważne spotkanie, poniżej jest
link do pliku - zajmij się tym.

  goo.gl/A6sMwA

Powodzenia!

--

Odzyskaną wiadomość umieść w komentarzu pod tym video :)
Linki do kodu/wpisów na blogu/etc z opisem rozwiązania są również mile widziane!

P.S. Rozwiązanie zadania przedstawię na jednym z vlogów w okolicy dwóch tygodni.
</code></pre><h3 id="zaczynamy">Zaczynamy!<a href="#zaczynamy" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Pod <a href="goo.gl/A6sMwA">linkiem</a> znajdującym się w misji, umieszczony został plik o rozszerzeniu bin. Polecenie <code>file</code> albo szybkie spojrzenie w hexedytor rozjaśnia sytuację - to archiwum 7z (jeśli Czytelnik spodziewał się radare2 w tym wątku - tak ono również rozumie tego magica ;] ).</p>
<blockquote>
<p>λ file 43842e832bfe28328309053ce1b1a49afc1047e5.bin
43842e832bfe28328309053ce1b1a49afc1047e5.bin: 7-zip archive data, version 0.4</p>
</blockquote>
<p>Wypakowanie zawartości zajmuje chwilę. Wewnątrz mamy 76 801 plików. Hm, no ciekawie. Okazuje się, że te pliki to <a href="https://pl.wikipedia.org/wiki/PCX">PCX</a> skompresowane RLE (hm, my się chyba znamy z innej misji). Żeby tego było mało wszystkie są jednakowej wielkości.</p>
<blockquote>
<p>λ file ffff609e5415<br>
ffff609e5415: PCX ver. 3.0 image data bounding box [0, 0] - [319, 239], 3 planes each of 8-bit colour, RLE compressed</p>
</blockquote>
<p>Przeczesałem główne archiwum jak i kilka pojedynczych randomowo wybranych plików. Niestety <code>exiftools</code> nie potrafiły znaleźć ukrytej treści. Czyli chyba trzeba rozwiązać to &ldquo;the hard way&rdquo; łącząc te obrazki. W związku z tym, że każdy był rozmiaru 320x240 i nieparzystej liczby to odrzuciłem od razu możliwość rozbicia dużego obrazu na pojedyncze i mniejsze. Zacząłem więc nakładać na siebie obrazki.</p>
<h3 id="pierwszy-fail">Pierwszy fail<a href="#pierwszy-fail" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Piniższy kod prezentuje moją próbę połączenia PCXów w jeden obrazek. Oczywiście strukturę pliku musiałem potem odtworzyć.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os

prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./wyj/&#34;</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
	fs <span style="color:#f92672">=</span> []
	<span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(prefix):
		<span style="color:#66d9ef">with</span> open(prefix <span style="color:#f92672">+</span> file, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
			fs<span style="color:#f92672">.</span>append(list(f<span style="color:#f92672">.</span>read()))

	<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;xoring now&#34;</span>)
	bstr <span style="color:#f92672">=</span> fs[<span style="color:#ae81ff">0</span>]
	<span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> fs[<span style="color:#ae81ff">1</span>:]:
		<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, k):
			bstr[i] <span style="color:#f92672">+=</span> f[i]

	<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;dump.bmp&#34;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
		f<span style="color:#f92672">.</span>write(bytes(bstr))

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
	main()
</code></pre></div><p>Niestety nie wiedziałem, że plik PCX nie obsługuje kanału ALFA czyli przeźroczytości. Dlatego po otrzymaniu wynikowego obrazka zobaczyłem wielki, ciekawy&hellip; czarny ekran. Tak wyglądało to w hexedytorze:</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/hexeditor.png" alt="hexeditor"></p>
<p>A tak po wczytaniu pliku raw (.data) przez GIMPa.</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/gimp.png" alt="gimp"></p>
<h3 id="rozwiązanie">Rozwiązanie<a href="#rozwiązanie" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Postanowiłem zmienić podejście i skonwertować PCX na BMP a następnie powtórzyć operację. Konwersji dokonałem za pomocą polecenia:</p>
<pre><code>mogrify -path &quot;path/here&quot; -format bmp *
</code></pre><p><a href="https://www.imagemagick.org/script/mogrify.php">Mogrify</a> uporał się z całą gromadką plików w niewiele ponad 5 minut. Zmodyfikowałem trochę skrypt. Stworzyłem obraz 400x400 (nie sprawdzałem pojedynczo plików, to był taki failsafe na wypadek wyjścia poza te 320x240) i zacząłem nakładać pixele. Kod wygląda tak:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> progressbar
<span style="color:#f92672">import</span> operator

prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./tmp/&#34;</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
	fs <span style="color:#f92672">=</span> []
	out <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;RGB&#34;</span>,(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">400</span>))
	pxs <span style="color:#f92672">=</span> out<span style="color:#f92672">.</span>load()
	out<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;output.bmp&#34;</span>)
	bar <span style="color:#f92672">=</span> progressbar<span style="color:#f92672">.</span>ProgressBar()
	<span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> bar(os<span style="color:#f92672">.</span>listdir(prefix)):
		im <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(prefix <span style="color:#f92672">+</span> file )
		row, col <span style="color:#f92672">=</span> im<span style="color:#f92672">.</span>size
		f <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#39;output.bmp&#39;</span>)
		pxs <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>load()
		<span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(row):
			<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> range(col):
				pxs[r,c] <span style="color:#f92672">=</span> tuple(map(operator<span style="color:#f92672">.</span>add, pxs[r,c], im<span style="color:#f92672">.</span>getpixel((r,c))))				
		f<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;output.bmp&#34;</span>)

	<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;END&#39;</span>)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
	main()
</code></pre></div><p>Z każdym kolejnym krokiem obrazek wyglądał coraz lepiej:</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress.png" alt="pr1"></p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress2.png" alt="pr2"></p>
<p>Tutaj pasek postępu i &ldquo;ETA&rdquo;:</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress3.png" alt="pr3"></p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress4.png" alt="pr4"></p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progressbar.png" alt="prbr"></p>
<p>Rozwiązanie coraz bliżej:</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress5.png" alt="pr5"></p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/progress6.png" alt="pr5"></p>
<p>No i obrazek w całości:</p>
<p><img src="https://foxtrotlabs.cc/pics/GLS011PL/output.bmp" alt="solution"></p>
<p>Śliczny widok ;) a dzisiejszą flagą jest:</p>
<p><code>Pocztówka z wakacji</code></p>
<p>Kudos dla KrzaQ, który wyprzedził mnie w swoim rozwiązaniu. Jego post znajdziecie <a href="https://dsp.krzaq.cc/post/1224/misja-gynvaela-011/">tutaj</a></p>
<p>Dzięki za misję Gyn!</p>

      </div></div>

  

  

<link rel="stylesheet" href="https://foxtrotlabs.cc/comments.css">
 <section class="post-comments">
  <script src='https://www.google.com/recaptcha/api.js'></script>
  <h3>Comments</h3>

  
  
  

  
    
  

  
    <p>Nothing yet.</p>
  

  <h3>Say something</h3>

  <form class="post-new-comment" method="POST" action="https://flabs-staticman.herokuapp.com/v2/entry/s3gm3nt4ti0nf4ult/s3gm3nt4ti0nf4ult.github.io/master/comments">
  
    <input type="hidden" name="options[redirect]" value="https://foxtrotlabs.cc/pl/2017/09/pl-misja-gynvaela-pl011/#comment-submitted">
    <input type="hidden" name="options[entryId]" value="d00eb79bbef1535100db5bd5dd7bd555">
    <input name="fields[name]" type="text" class="post-comment-field" placeholder="Your name">
    <input name="fields[email]" type="email" class="post-comment-field" placeholder="Your email address">
    <textarea name="fields[body]" class="post-comment-field" placeholder="Your message. Feel free to use Markdown." rows="10"></textarea>
    <input type="hidden" name="options[reCaptcha][siteKey]" value="6Lco6bkZAAAAAPwhdzJftINmETZymWpv1s8w1hKR">
    <input type="hidden" name="options[reCaptcha][secret]" value="LIrSDvvGlpdtRj5u1ERCiGLqhTgNVgs9kQoezb44tjrr83UiTbPCaem4CyKSxgXmkdI5CCOyheyPHa7PpZI7na9ZfI/RP4CYyHEj2TF2LdoVJ8ZclSuQiDw5h5SbgWNmKTOGODDwnEVQfy3dU0wZOKXYwUXqgKmW+wI49+Yz27DsHwe3UD+AclUnacU/A58F21iFPwcSaOkfxPz5Jz0mVk+8U25k/jO4LVAHB4/Uji6pBD9UT0H+9YzhsakPn5Cuak5FepB4+wxytndygr4X2YJSa+RMZCGBDqApqrinKRcDsq3CLmno8EfjJ4878iEaLeje4HAlgCjEdaY0GDBG7g==">
    <div class="g-recaptcha" data-sitekey="6Lco6bkZAAAAAPwhdzJftINmETZymWpv1s8w1hKR"></div>
    <input type="submit" class="post-comment-field btn" value="Submit">
  </form>
</section>

<div id="comment-submitted" class="dialog">
<h3>Thank you</h3>
  <p>Your comment has been submitted and will be published once it has been approved.</p>
  <p><a href="#" class="btn">OK</a></p>
</div>

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>copyright by foxtrot_charlie</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://foxtrotlabs.cc/assets/main.js"></script>
<script src="https://foxtrotlabs.cc/assets/prism.js"></script>





  
</div>

</body>
</html>
